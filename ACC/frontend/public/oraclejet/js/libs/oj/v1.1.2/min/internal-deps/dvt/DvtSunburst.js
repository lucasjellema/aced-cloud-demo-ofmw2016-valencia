/**
 * Copyright (c) 2014, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(['./DvtToolkit', './DvtBaseTreeView'], function(dvt) {
  // Internal use only.  All APIs and functionality are subject to change at any time.
    // Map the D namespace to dvt, which is used to provide access across partitions.
  var D = dvt;
  D.QC=function(a,b){this.Init(b===D.p?"sunburstRotationInput":"sunburstRotation");this.Md=a%360};(0,D.ca)("DvtSunburstRotationEvent",D.QC);D.z.q(D.QC,D.$i,"DvtSunburstRotationEvent");D.QC.TYPE="sunburstRotation";D.QC.TYPE_INPUT="sunburstRotationInput";D.QC.prototype.Ara=(0,D.x)("Md");D.QC.prototype.getStartAngle=D.QC.prototype.Ara;
D.DR=function(a,b,c){this.Init(a,b,c)};(0,D.ca)("DvtSunburst",D.DR);D.z.q(D.DR,D.ER,"DvtSunburst");D.DR.newInstance=function(a,b,c){return new D.DR(a,b,c)};D.y=D.DR.prototype;D.y.Init=function(a,b,c){D.DR.u.Init.call(this,a,b,c);this.Of=new D.FR;this.be=2*window.Math.PI};
D.y.aN=function(a){D.DR.u.aN.call(this,a);a=this.A();this.noa=(0,D.dj)()?"url("+a._resources.rotateCursor+"), auto":"url("+a._resources.rotateCursor+") 8 8, auto";this.Md=(360-a.startAngle)*D.GR/360;this.Md>window.Math.PI&&(this.Md-=D.GR);"auto"==a.animationOnDisplay&&(a.animationOnDisplay="fan")};
D.y.Wp=function(a){var b=window.Math.max(window.Math.ceil(3*window.Math.min(a.e,a.g)/400),2);a.x+=b;a.y+=b;a.e-=2*b;a.g-=2*b;(0,D.HR)(this,a);this.Hb=D.IR.U(this,a,this.kX);this.cpa=window.Math.floor(window.Math.min(a.e,a.g)/2);this.Ra&&D.JR.Qq(this.cpa,this.Ra,this.Md,this.be,this.A().sorting)};
D.y.Kj=function(a,b){(0,D.KR)(this,a);this.Um&&a.k(this.Um);this.Hb&&(a.k(this.Hb),this.Hb=D.o);this.Kx=new D.H(b.x+b.e/2,b.y+b.g/2);if("off"!=this.A().rotation&&(0,D.LR)(this)){var c=(0,D.Mf)()?60:15,c=new D.No(this.j(),b.x+b.e/2,b.y+b.g/2,this.cpa+c);(0,D.Li)(c);c.setCursor(this.noa);a.k(c);this.za().Da(c,new D.MR(D.o,"_rotationShape"))}c=new D.D(this.j());(0,D.Ik)(c,this.Kx.x,this.Kx.y);a.k(c);if((0,D.LR)(this)){var d=new D.D(this.j());c.k(d);this.Ra.U(d);(0,D.NR)(this,this.Ra);this.Ex=new D.D(this.j());
c.k(this.Ex);this.Qka=new D.D(this.j());c.k(this.Qka)}else(0,D.OR)(this,a)};D.y.mI=function(a,b,c,d){return new D.PR(a,b,c,d)};D.y.A1=function(a,b){if("fan"===this.A().animationOnDisplay&&(0,D.LR)(this)){this.N3(0);var c=new D.jo(this.j(),this,this.fI);(0,D.T)(c.O,"typeNumber",this,this.sya,this.N3,2*window.Math.PI);return c}return D.DR.u.A1.call(this,a,b)};D.y.z1=function(){var a=D.DR.u.z1.call(this);a&&(0,D.Ik)(a,this.Kx.x,this.Kx.y);return a};
D.y.br=function(){if(!this.I0){this.ga.Ql();var a=new D.B(0,0,this.Za,this.ob);this.Wp(a);this.Kj(this.ga,a);for(var a=this.Ob?this.Ob.getSelection():[],b=0;b<a.length;b++)a[b].rb(D.k)}this.be<2*window.Math.PI&&this.N3(2*window.Math.PI);D.DR.u.br.call(this)};D.y.HU=function(a){this.Ex.k(a);!(0,D.nr)()&&!(0,D.Gj)()&&((0,D.fA)(this.Ex),(0,D.Hp)(this.Ex,D.QR))};D.y.sya=(0,D.x)("be");D.y.N3=function(a){this.be=a;this.Wp(new D.B(0,0,this.Za,this.ob));this.Ra&&(0,D.RR)(this.Ra,D.k)};
D.SR=function(a,b){a.l5=b;a.YK=new D.F(a.j(),0,0,a.Za,a.ob);(0,D.Li)(a.YK);a.YK.setCursor(a.noa);a.k(a.YK);a.za().Da(a.YK,new D.MR(D.o,"_rotationShape"))};D.TR=function(a,b){var c=b-a.l5;a.l5=b;a.Md+=c;a.Md<-window.Math.PI?a.Md+=2*window.Math.PI:a.Md>window.Math.PI&&(a.Md-=2*window.Math.PI);a.Wp(new D.B(0,0,a.Za,a.ob));a.Ra&&(0,D.RR)(a.Ra,D.k);a.Wa(new D.QC(360-window.Math.round(180*a.Md/window.Math.PI),D.p))};
D.UR=function(a){a.l5=D.o;a.removeChild(a.YK);a.YK=D.o;var b=360-window.Math.round(180*a.Md/window.Math.PI);a.Wa(new D.QC(b,D.p));a.Wa(new D.QC(b,D.k))};D.VR=function(a,b,c){return window.Math.atan2(c-a.Kx.y,b-a.Kx.x)};D.y=D.DR.prototype;D.y.LE=function(a,b){return this.Ra.qD(a-this.Kx.x,b-this.Kx.y)};D.y.uu=function(a){(a=D.DR.u.uu.call(this,a))&&(0,D.Ik)(a,this.Kx.x,this.Kx.y);return a};D.y.Yj=function(){return(0,D.Gk)(this.A(),"componentName","DvtUtilBundle","SUNBURST")};D.y.GZ=(0,D.ba)("DvtSunburstBundle");
D.y.Sp=function(a){return new D.WR(this,a)};
D.WR=function(a,b){this.Init(a,b);var c=this.K.A().nodeDefaults;this.zr=b.labelDisplay?b.labelDisplay:c.labelDisplay;this.kK=b.labelHalign?b.labelHalign:c.labelHalign;this.ao=b.radius};D.z.q(D.WR,D.cS,"DvtSunburstNode");D.GR=2*window.Math.PI;
D.WR.prototype.U=function(a){if(this.Vu){this.zX=a;this.I=this.j5();a.k(this.I);var b=(0,D.dS)(this);if(!this.sg&&(0==this.jk&&this.be==D.GR)&&b){var c=window.Math.sqrt(2),d=this.tj*c-4;this.Eb=-this.tj/c+2;this.Yb=-this.tj/c+2;var c=this.A()._cf,e=this.K.Ec;e.pr=c;0<d&&0<d&&((0,D.vg)(e,d),(0,D.wg)(e,d),e.He((0,D.eS)(this)),this.X4=b=D.ye.RH(e,b,this.I),c=b.G(),(0,D.Ik)(b,this.Eb+(d-c.e)/2,this.Yb+(d-c.g)/2))}else this.Pb=this.JO(this.I),this.Pb!=D.o&&(this.I.k(this.Pb),this.Kr&&(c=this.Pb.Kb(),this.Or=
new D.F(this.K.j(),c.x,c.y,c.e,c.g),this.Or.va("#FFFFFF"),this.Or.ua(D.p),this.I.k(this.Or),d=this.Pb.Ea(),(0,D.xF)(d)||this.Or.Ga(d),this.I.k(this.Pb)));this.I.ld("img");this.Rm();this.ky(a)}};D.WR.prototype.rb=function(a){D.WR.u.rb.call(this,a);this.Fa()?(this.I.rb(D.k),this.K.HU(this.I)):(this.I.rb(D.p),this.zX&&this.zX.k(this.I))};D.WR.prototype.Sb=function(){this.I&&this.Vu&&(this.I.Sb(),this.Fa()?this.K.HU(this.I):this.K.Qka.k(this.I))};
D.WR.prototype.Ib=function(){this.I&&(this.Vu&&!this.Ic())&&(this.I.Ib(),!this.Fa()&&this.zX&&this.zX.k(this.I))};D.$R=function(a){return"insert"==a.uF||"insertAndReplace"==a.uF};
D.WR.prototype.Yd=function(a){var b,c,d,e;if(a.type==D.vn)return D.WR.u.Yd.call(this,a);b=a.keyCode;if(32==b&&a.ctrlKey)return this;for(e=this;e.sg;)e=e.sg;c=(0,D.fS)(this,e,(0,D.gS)(this));a:{for(d=0;d<c.length;d++)if(this===c[d])break a;d=-1}var f=this.Md+this.be/2,f=(0,D.hS)(f);switch(b){case 38:if(this===e||180<f){if(b=this.iX)if(c=b.Md+b.be/2,c=(0,D.hS)(c),180<c)return b;a=(0,D.wn)(this,a,(0,D.iS)(this))}else a=(0,D.jS)(this);break;case 40:if(this===e||0<=f&&180>=f){if(b=this.iX)if(c=b.Md+b.be/
2,c=(0,D.hS)(c),0<=c&&180>=c)return b;a=(0,D.wn)(this,a,(0,D.iS)(this))}else a=(0,D.jS)(this);break;case 37:a=1==c.length?this:0==d?c[c.length-1]:c[d-1];break;case 39:a=1==c.length?this:d==c.length-1?c[0]:c[d+1];break;default:a=this}(0,D.kS)(a);return a};D.jS=function(a){var b=a.sg;b&&(a=b,(0,D.kS)(b));(0,D.kS)(a);return a};D.hS=function(a){a=D.yg.HM(a);0>a?a+=360:360<a&&(a-=360);return a};D.y=D.WR.prototype;
D.y.Ye=function(){if(this.I){var a=this.I.G(),b=new D.H(a.x,a.y),b=(0,D.ef)(this.I,b);a.x=b.x;a.y=b.y;return a}return new D.B(0,0,0,0)};D.y.Vj=function(){return this.I?this.I.Aa():D.o};D.y.DR=function(){return(0,D.ef)(this.I,(0,D.lS)(0.5*(this.tj+this.jk),this.Md+this.be/2))};D.y.dT=function(a,b,c,d){this.jk=a;this.tj=b;this.Md=c;this.be=d;this.Vu=D.k};D.y.sI=function(){return this.fJ?(0,D.Uo)():D.WR.u.sI.call(this)};
D.y.Hm=function(a){var b=D.K.we(this.fk),c=D.K.ue(this.fk),d=D.K.qe(this.fk),e=this.Md;a&&!(0,window.isNaN)(a[2])&&(a=a[2],a-this.Md>window.Math.PI?e+=D.GR:this.Md-a>window.Math.PI&&(e-=D.GR));return[this.jk,this.tj,e,this.be,b,c,d]};D.y.dr=function(a){this.dT(a[0],a[1],a[2],a[3]);this.fk=D.K.MA(window.Math.round(a[4]),window.Math.round(a[5]),window.Math.round(a[6]));(0,D.RR)(this,D.p)};D.y.Cf=function(a,b){b.Vu&&0<b.be?D.WR.u.Cf.call(this,a,b):this.Vg(a)};
D.y.qD=function(a,b){if(this.contains(a,b))return this;for(var c=this.Gc(),d=0;d<c.length;d++){var e=c[d].qD(a,b);if(e)return e}return D.o};D.y.contains=function(a,b){var c=(0,D.mS)(a,b);return window.Math.sqrt(a*a+b*b)>=this.jk&&window.Math.sqrt(a*a+b*b)<=this.tj&&(0,D.nS)(this,c)};D.nS=function(a,b){for(;b<a.Md;)b+=D.GR;for(;b-a.Md>D.GR;)b-=D.GR;return b>=a.Md&&b<=a.Md+a.be};D.lS=function(a,b){return{x:window.Math.cos(b)*a,y:window.Math.sin(b)*a}};
D.mS=function(a,b){var c=window.Math.atan2(b,a);0>c?c+=D.GR:c>D.GR&&(c-=D.GR);return c};
D.WR.prototype.j5=function(){if(!this.be||0>=this.be)return D.o;var a=(0,D.oS)(this),a=new D.Vh(this.K.j(),a);this.K.za().Da(a,this);a.D(this.ma());a.P(this.sI());var b=this.K.A().nodeDefaults;a.ba(new D.J(b.borderColor,0.3));a.Ho(new D.J(b.hoverColor,1,3));a.Jo(new D.J(b.selectedInnerColor,1,1.5),new D.J(b.selectedOuterColor,1,3.5));a.Jp(new D.J(b.hoverColor,1,3));a.Xf(this.Oa());this.fJ&&(a.D(0.001),a.ua(D.p));return a};
D.oS=function(a){var b,c,d,e;a.be<D.GR?(b=(0,D.lS)(a.tj,a.Md),c=(0,D.lS)(a.tj,a.Md+a.be),d=(0,D.lS)(a.jk,a.Md+a.be),e=(0,D.lS)(a.jk,a.Md),b=D.M.moveTo(b.x,b.y)+D.M.arcTo(a.tj,a.tj,a.be,1,c.x,c.y)+D.M.lineTo(d.x,d.y)+D.M.arcTo(a.jk,a.jk,a.be,0,e.x,e.y)+D.M.closePath()):(b=(0,D.lS)(a.tj,a.Md),c=(0,D.lS)(a.tj,a.Md+a.be/2),d=(0,D.lS)(a.jk,a.Md),e=(0,D.lS)(a.jk,a.Md+a.be/2),b=D.M.moveTo(b.x,b.y)+D.M.arcTo(a.tj,a.tj,a.be/2,1,c.x,c.y)+D.M.arcTo(a.tj,a.tj,a.be/2,1,b.x,b.y),0<a.jk&&(b+=D.M.moveTo(e.x,e.y)+
D.M.arcTo(a.jk,a.jk,a.be/2,0,d.x,d.y)+D.M.arcTo(a.jk,a.jk,a.be/2,0,e.x,e.y)),b+=D.M.closePath());return b};
D.WR.prototype.JO=function(a){if(!this.YC||(!a||!this.zr||"off"==this.zr)||this==this.K.Ra&&this.be<D.GR)return D.o;var b=D.p;if("auto"==this.zr){if(b=!(0,D.dj)())(0,D.qG)(),b="Windows"==D.jG;b=b?D.p:D.k}else"rotated"==this.zr&&(b=D.k);if(b&&this.be<this.K.be){var c=window.Math.max(this.jk,10),d=this.tj-c-6,e=1.1*this.be*(c+6);if(6>=e)a=D.o;else if(b=new D.Nf(this.K.j(),this.YC,0,0),b.He((0,D.eS)(this)),(0,D.pS)(this,b),D.af.Vb(b,d,e,a)){d=(c+this.tj)/2;if("inner"==this.kK||"outer"==this.kK)a.k(b),
a=b.G().e,"inner"==this.kK?d=c+4.5+a/2:"outer"==this.kK&&(d=this.tj-4.5-a/2);a=(0,D.lS)(d,this.Md+this.be/2);b.df();b.Jg();c=this.Md+this.be/2;c=c>=D.GR?c-D.GR:c;c=0>c?c+D.GR:c;c>0.5*window.Math.PI&&c<1.5*window.Math.PI&&(c+=window.Math.PI);b.Xj(c);(0,D.Ik)(b,a.x,a.y);b.ua(D.p);a=b}else a=D.o}else{if(0==this.jk)b={x:0,y:0};else if(b=(0,D.lS)((this.jk+this.tj)/2,this.Md+this.be/2),c=3*(0,D.eS)(this)/2,d=(0,D.mS)(b.x+c/2,b.y),!(0,D.nS)(this,(0,D.mS)(b.x-c/2,b.y))||!(0,D.nS)(this,d))b=D.o;if(b){c=new D.Nf(this.K.j(),
this.YC,b.x,b.y,D.o);c.He((0,D.eS)(this));(0,D.pS)(this,c);c.df();c.Jg();c.ua(D.p);for(var d=D.af.Ch(c),f=e=b.x,g=b.y-d.g/2,h=b.y+d.g/2;this.contains(e,g)&&this.contains(e,h);)e--;for(;this.contains(f,g)&&this.contains(f,h);)f++;e+=3;f-=3;b=2*window.Math.min(b.x-e,f-b.x);b<d.e&&(c.ha((e+f)/2),b=f-e);a=D.af.Vb(c,b,d.g,a)?c:D.o}else a=D.i}return a};
D.WR.prototype.vA=function(){if(!this.Xc){var a;a=this.I;var b=this.lb();if(!a||!(0,D.$R)(this)||!this.gf()&&b)a=D.o;else{if(b)var b=this.K.j(),c=this.K.A()._resources,d=new D.Ve(b,c.collapse,0,0,16,16),e=new D.Ve(b,c.collapseOver,0,0,16,16),c=new D.Ve(b,c.collapseDown,0,0,16,16);else b=this.K.j(),c=this.K.A()._resources,d=new D.Ve(b,c.expand,0,0,16,16),e=new D.Ve(b,c.expandOver,0,0,16,16),c=new D.Ve(b,c.expandDown,0,0,16,16);(0,D.Li)(d);(0,D.Li)(e);(0,D.Li)(c);b=new D.Re(b,d,e,c);b.oa(D.vn,this.W$,
D.p,this);d=(0,D.lS)(this.tj,this.Md+this.be/2);(0,D.Ik)(b,d.x-8,d.y-8);a.k(b);a=(0,D.O)("DvtUtilBundle",this.lb()?"COLLAPSE":"EXPAND");this.K.za().Da(b,new D.MR(this,this.getId(),a));a=b}this.Xc=a}D.WR.u.vA.call(this)};D.WR.prototype.Zt=function(){this.Xc&&this.I&&(this.I.removeChild(this.Xc),this.Xc=D.o);D.WR.u.Zt.call(this)};
D.RR=function(a,b){if(a.I){var c=(0,D.oS)(a);a.I.Ij(c);if(a.sg||!(0==a.jk&&a.be==D.GR))a.Pb&&a.I.removeChild(a.Pb),a.Pb=a.JO(a.I),a.Or&&(a.I.removeChild(a.Or),a.Or=D.o);a.I.P(a.sI());if(b)for(var c=a.Gc(),d=0;d<c.length;d++)(0,D.RR)(c[d],D.k)}};D.WR.prototype.gH=function(){return this.I instanceof D.No?new D.No(this.K.j(),this.I.Vi(),this.I.Wi(),this.I.Cj()):this.I instanceof D.Vh?new D.Vh(this.K.j(),this.I.jA()):D.o};
D.WR.prototype.W$=function(a){this.mf(!this.lb());var b=this.K,c=this.lb(),d=this.getId();b.YP=d;c?(c=this.A(),c.nodes&&0<c.nodes.length&&b.U(b.A()),b.Wa(new D.aS("sunburstExpand",this.getId()))):(b.U(b.A()),b.Wa(new D.aS("sunburstCollapse",this.getId())));this.Rm();a.stopPropagation()};D.bS=function(a){return a.ao!=D.o?(0,window.Number)(a.ao):a.sg?1:a.fJ?0.25:(0,D.dS)(a)?1:0.5};
D.WR.prototype.nc=function(){var a=this.K.A(),b=[];this.Oa()&&b.push((0,D.O)("DvtUtilBundle",this.Fa()?"STATE_SELECTED":"STATE_UNSELECTED"));(0,D.$R)(this)&&b.push((0,D.O)("DvtUtilBundle",this.lb()?"STATE_EXPANDED":"STATE_COLLAPSED"));this.Oq()&&b.push((0,D.Gk)(a,"stateDrillable","DvtUtilBundle","STATE_DRILLABLE"));return(0,D.Hk)(this.ed(),b)};D.WR.prototype.Rm=function(){!(0,D.df)()&&this.I&&this.I.Mb("label",this.nc())};
D.WR.prototype.Fv=function(){var a=D.WR.u.Fv.call(this);a.radius=(0,D.bS)(this);return a};
D.JR={};D.z.q(D.JR,D.z,"DvtSunburstLayout");D.JR.Qq=function(a,b,c,d,e){var f=D.JR.pia(b);D.JR.qf(a/f,b,c,d,e,0)};D.JR.qf=function(a,b,c,d,e,f){var g=f+(0,D.bS)(b)*a;b.dT(f,g,c,d);f=b.Gc();if(f!=D.o&&b.lb()){"on"==e&&(f=f.slice(0),f.sort(function(a,b){return b.$c()-a.$c()}));(0,D.G)(b.K.j())&&(f=f.slice(0).reverse());var h=0;for(b=0;b<f.length;b++)h+=0<f[b].$c()?f[b].$c():0;for(b=0;b<f.length;b++){var j=f[b];if(!(0>=j.$c())){var l=j.$c()/h*d;D.JR.qf(a,j,c,l,e,g);c+=l}}}};
D.JR.pia=function(a){var b=0,c=a.Gc();if(c&&0<c.length){for(var d=0;d<c.length;d++)var e=D.JR.pia(c[d]),b=window.Math.max(b,e);return b+(0,D.bS)(a)}return(0,D.bS)(a)};
D.aS=function(a,b){this.Init(a);this.ib=b?b:D.o};D.z.q(D.aS,D.$i,"DvtSunburstExpandCollapseEvent");D.aS.prototype.getId=(0,D.x)("ib");
D.PR=function(a,b,c,d){D.ZR.call(this,a,b,c,d)};D.z.q(D.PR,D.ZR,"DvtSunburstEventManager");D.y=D.PR.prototype;D.y.Mn=function(a){var b=(0,D.Xj)(this,a.target);b&&b.getId&&"_rotationShape"==b.getId()&&!this.lV?(this.lV=D.k,a=(0,D.nv)(this.$,a.pageX,a.pageY),b=this.K,(0,D.SR)(b,(0,D.VR)(b,a.x,a.y))):D.PR.u.Mn.call(this,a)};D.y.Es=function(a){if(this.lV){a=(0,D.nv)(this.$,a.pageX,a.pageY);var b=this.K;(0,D.TR)(b,(0,D.VR)(b,a.x,a.y))}else D.PR.u.Es.call(this,a)};
D.y.Nn=function(a){this.lV?(this.lV=D.p,(0,D.UR)(this.K)):D.PR.u.Nn.call(this,a)};D.y.Jh=function(a){var b=D.k,c=a.keyCode,d=this.Od(),e=this.K;(0,D.$R)(d)&&((0,D.qn)(a)&&!d.lb()||(0,D.rn)(a)&&d.lb()||a.ctrlKey&&13==c)?(d.W$(),(0,D.ti)(a)):e&&"off"!=e.A().rotation&&(37==c||39==c)&&!a.ctrlKey&&a.altKey&&a.shiftKey?(c=37==c?-5*(window.Math.PI/180):5*(window.Math.PI/180),(0,D.SR)(e,0),(0,D.TR)(e,c),(0,D.UR)(e),(0,D.ti)(a)):b=D.PR.u.Jh.call(this,a);return b};
D.y.wI=function(a){var b=(0,D.Xj)(this,a.target);b&&(b.getId&&"_rotationShape"==b.getId())&&(0,D.pv)(a,this.Yva,this)};D.y.MT=function(a){(0,D.qv)(this.tc,a,"rotateKey")};D.y.LT=function(a){(0,D.sv)(this.tc,a,"rotateKey")};D.y.Yva=function(a,b){if(1>=(0,D.tv)(this.tc,"rotateKey").length){(0,D.uv)(this.tc,b.identifier,"rotateKey","rotateKey","rotateKey",this.Xva,this.Wva,this);(0,D.hn)(this.tc,b.identifier,D.p);var c=(0,D.nv)(this.$,b.pageX,b.pageY),d=this.K;(0,D.SR)(d,(0,D.VR)(d,c.x,c.y));a.bD()}};
D.y.Xva=function(a,b){var c=(0,D.nv)(this.$,b.pageX,b.pageY),d=this.K;(0,D.TR)(d,(0,D.VR)(d,c.x,c.y));a.preventDefault()};D.y.Wva=function(){(0,D.UR)(this.K)};
(0,D.Lg)("DvtSunburstBundle",{COLOR:"Color",OTHER:"Other",SIZE:"Size"});
D.FR=function(){this.Init({skyros:D.XR,alta:{}})};D.z.q(D.FR,D.YR,"DvtSunburstDefaults");D.XR={nodeDefaults:{borderColor:"#FFFFFF",hoverColor:"#FFFFFF",labelDisplay:"auto",labelHalign:"center",selectedInnerColor:"#FFFFFF",selectedOuterColor:"#000000"},rotation:"on",startAngle:90};
  return D;
});