/**
 * Copyright (c) 2014, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(['./DvtToolkit', './DvtOverview'], function(dvt) {
  // Internal use only.  All APIs and functionality are subject to change at any time.
    // Map the D namespace to dvt, which is used to provide access across partitions.
  var D = dvt;
  D.GU=function(a,b,c){this.Init(a,b,c)};(0,D.ca)("DvtTimelineOverview",D.GU);D.z.q(D.GU,D.pp,"DvtTimelineOverview");D.GU.prototype.Init=function(a,b,c){D.GU.u.Init.call(this,a,b,c);a=[D.K.sD(D.K.xm("#aadd77",0.35)),"#aadd77",D.K.sD(D.K.tn("#aadd77",0.5))];D.hP.Vl()&&(a=["#aadd77"]);this.s5=a;this.gma=(0,D.Uo)();this.ot=12};D.GU.prototype.sra=function(){return new D.dV(this)};
D.GU.prototype.Jw=function(a){D.GU.u.Jw.call(this,a);this.xq=a.TS;this.Ez=a.NLa;this.sY=a.CMa;this.t5=a.Ypa;this.J5="#267DB3 #68C182 #FAD55C #ED6647 #8561C8 #6DDBDB #FFB54D #E371B2 #47BDEF #A2BF39 #A75DBA #F7F37B".split(" ");a="solid"==this.C("_","bs")?(0,window.parseInt)(this.C("_","bof"),10):1;var b="solid"==this.C("_as","bs")?(0,window.parseInt)(this.C("_as","bof"),10):1,c="solid"==this.C("_s","bs")?(0,window.parseInt)(this.C("_s","bof"),10):1;this.pX="none"!=this.xq?window.Math.max(b,c,a,1)/2+
1:1;this.RO=this.Tc()?0:0.75;this.kja=[this.RO,this.RO,this.RO];this.bEa=new D.lg(250,this.s5,this.kja);this.ICa=new D.lg(180,this.s5,this.kja);a=this.Tc()?0:1;this.Jza=new D.J("#aadd77",a)};D.eV=function(a,b){for(var c="_mrk_"+b,d="_drn_"+b,e=a.Ka(),f=0;f<e;f++){var g=a.la(f);if(g!=D.o&&(c==g.getId()||d==g.getId()))return g}return D.o};D.y=D.GU.prototype;D.y.kH=function(a){return a.getId().substr(5)};D.y.C=function(a,b){return this.Lza[a+b]};D.y.pa=function(a){return a.Qb!=D.o?a.Qb.pa():a.Ea().Fc};
D.y.qa=function(a){return a.Qb!=D.o?a.Qb.qa():a.Ea().zc};D.y.Ac=function(a){a=a.Ac();a==D.o&&(a=this.Tc()?(this.Za-this.wD()-4)/2:1);return a};D.y.Hc=function(a){a=a.Hc();a==D.o&&(a=1);return a};
D.y.MS=function(a,b){D.GU.u.MS.call(this,a,b);if(this.Ez!=D.o){for(var c=(0,D.fV)(this,this.vb,this.hc,a,b,this.ot),d=[],e=0;e<this.Ez.length;e++){var f=this.Ez[e];f.Mk==D.o?this.w$(f,c):d[d.length]=f}this.j0(d);e=this.j();for(f=this.M7;0<f;f--)for(var g=0;g<d.length;g++){var h=d[g];if(f==h.Us){var j=D.hP.te(this.vb,this.hc,h.getTime(),this.Tc()?this.ob:this.Za),l="_drn_"+h.getId(),m=9+5*h.Us,n=D.hP.te(this.vb,this.hc,h.Mk,this.Tc()?this.ob:this.Za),j=this.Tc()?this.Oc()?new D.F(e,0,j,m,n-j,l):new D.F(e,
this.Za-m,j,m,n-j,l):this.Oc()?new D.F(e,this.Za-n,this.ob-m-20,n-j,m,l):new D.F(e,j,this.ob-m-20,n-j,m,l);j.P(new D.xo(h.mz));l=new D.J(this.C("_","dbc"),1,1);j.ba(l);(0,D.Ti)(j);j.Qb=h;this.k(j);h.I5=j;h.NOa=m-2}}this.removeChild(this.Voa);this.k(this.Voa);this.ot=c}};
D.y.j0=function(a){this.M7=0;var b=D.o;this.GJ==D.o&&(this.GJ={});for(var c=0;c<a.length;c++){var d=a[c],e=d.getId(),f=e.substring(e.indexOf(":")+1,e.length),f=f.substring(0,f.indexOf(":"));f!=b&&(this.Tw=0,b=f);d.Us=(0,D.gV)(this,d,a);d.mz==D.o&&(this.GJ[e]==D.o?(this.GJ[e]=this.Tw,d.mz=this.J5[this.Tw],this.Tw++,this.Tw==this.J5.length&&(this.Tw=0)):d.mz=this.J5[this.GJ[e]])}};D.y.sIa=function(){return this.GJ?this.GJ:D.o};D.GU.prototype.getDurationColorMap=D.GU.prototype.sIa;
D.fV=function(a,b,c,d,e,f){for(var g,h,j={max:1,y$:[]},l=a.Tc()?e:d,m=0;m<a.Ez.length;m++){var n=a.Ez[m];if(n.Mk!=D.o){var q=D.hP.te(b,c,n.getTime(),l);(0,D.kP)(a)&&(q=l-q);n.ha(q)}else{var q=a,r=b,s=c,u=l,A=f/2,w=j,E=e,P=A*q.Ac(n)+q.pX,N=A*q.Hc(n)+q.pX,r=D.hP.te(r,s,n.getTime(),u);(0,D.kP)(q)&&(r=u-r-2*P);if(q.Tc())A=0,"solid"==q.C("_","bs")&&(A=(0,window.parseInt)(q.C("_","bw"),10)),u=q.Oc()?A+4:q.Za-2*q.Ac(n)-A-4;else for(var u=3,L=0,s=0;1>s;){g=q;h=w;var W=n.yb(),U=r,ga=u,qa=P,Fa=N,Ga=A,cb=E;
"above"==g.MX&&(ga+=(0,D.uP)(g));for(var Gb=0;Gb<h.y$.length;Gb++){var yb=h.y$[Gb],zb=yb.pa(),sc=yb.qa(),gc=yb.yb(),wd=g.Ac(yb),yb=g.Hc(yb),zb=window.Math.abs(U-zb),Oc=Ga*wd+g.pX+qa;if(!(zb>=Oc)&&(gc="circle"==W&&"circle"==gc&&qa==Fa&&wd==yb?window.Math.sqrt(Oc*Oc-zb*zb):Ga*yb+g.pX+Fa,gc>window.Math.abs(ga-sc)&&(ga=sc+gc,L=window.Math.max(L,ga+gc),1<=Ga&&cb!=D.i&&L>cb)))break}g=ga;h=L;g==u&&(s=1);L=h;u=g;s++}n.ha(r);n.ya(u);w.y$.push(n);L>w.max&&(w.max=L);if(j.max>e)break}}return j.max>e&&1<f?(0,D.fV)(a,
b,c,d,e,f-1):f};
D.GU.prototype.w$=function(a,b){var c="_mrk_"+a.getId(),d=a.zb(),e=a.t6,f=a.Maa();f==D.o&&(f=this.RO,0==f&&d!=D.o&&(f=1));var g=this.Ac(a),h=this.Hc(a),j=a.yb();this.Tc()?(j="square",c=new D.mh(this.j(),j,D.o,a.qa(),a.pa(),2,2,c,g,h)):c=new D.mh(this.j(),j,D.o,a.pa(),a.qa(),b,b,c,g,h);c.Qb=a;d==D.o&&f==this.RO&&e==D.o?(e="circle"==j?this.bEa:this.ICa,d=this.Jza):(g=this.s5,d!=D.o&&(D.hP.Vl()?g=[d]:(g=D.K.xm(d,0.5),h=D.K.tn(d,0.5),g=[g,d,h])),h=[f,f,f],e=e==D.o?"circle"==j?new D.lg(250,g,h):new D.lg(180,
g,h):new D.xo(d,h[0]),d=new D.J(d,f));c.P(e);c.ba(d);"none"!=this.xq&&c.Xf(D.k);d=this.Ka();f=this.la(d-1);d>this.rq&&("tb"==f.getId()||"arr"==f.getId())?this.Ua(c,d-this.rq):this.k(c);a.Df(c);this.no(c,"_");(this.Tc()||"square"==j||"diamond"==j||"triangleUp"==j||"triangleDown"==j||"plus"==j)&&"false"!=this.t5.hca&&(0,D.Ti)(c);return c};
D.gV=function(a,b,c){var d=c.length,e=b.getTime(),f=b.Us;f==D.o&&(f=1);for(var g=0;g<d;g++){var h=c[g];if(h!=b){var j=h.Mk;if(j!=D.o){var l=h.getTime(),h=h.Us;h==D.o&&(h=1);e>=l&&(e<=j&&f==h)&&(f=h+1,b.Us=f,f=(0,D.gV)(a,b,c))}}}f>a.M7&&(a.M7=f);return f};
D.GU.prototype.ST=function(a){var b=D.GU.u.ST.call(this,a);if(b!=D.o){if(b.Qb!=D.o){var c=b.Qb.TO;c!=D.o&&this.j().jd().YM(a.pageX,a.pageY,c,"#000000");this.AH()&&this.setCursor("pointer")}if("none"!=this.xq){a=D.p;if(this.ok!=D.o)for(c=0;c<this.ok.length;c++)if(b==this.ok[c]){a=D.k;break}a||(a=this.kH(b),c=new D.hV("highlight"),(0,D.km)(c,"itemId",a),this.dispatchEvent(c),(0,D.iV)(this,b))}}};
D.GU.prototype.RT=function(a){a=D.GU.u.RT.call(this,a);if(a!=D.o&&!(0,D.HP)(a)){this.j().jd().Mc();var b=D.p;if(this.ok!=D.o)for(var c=0;c<this.ok.length;c++)if(a==this.ok[c]){b=D.k;break}b||(b=this.kH(a),c=new D.hV("unhighlight"),(0,D.km)(c,"itemId",b),this.dispatchEvent(c),(0,D.jV)(this,a))}};
D.GU.prototype.wE=function(a,b,c){b=D.GU.u.wE.call(this,a,b,c);if(b!=D.o&&(a=a.ctrlKey||a.shiftKey||(0,D.Mf)(),"none"!=this.xq)){c=this.kH(b);var d=new D.hV("selection");(0,D.km)(d,"itemId",c);(0,D.km)(d,"multiSelect",a);this.dispatchEvent(d);a=b.Qb.getTime();a!=D.o&&(c=new D.hV("scrollTime"),c.setTime(a),this.dispatchEvent(c),a=this.la(1),b=this.Tc()?this.pa(b)-a.getHeight()/2:this.pa(b)-a.getWidth()/2,(0,D.wP)(this,b))}};
D.iV=function(a,b){if(a.ok!=D.o)for(var c=0;c<a.ok.length;c++)if(b==a.ok[c])return;a.no(b,"_h")};D.jV=function(a,b){if(a.ok!=D.o)for(var c=0;c<a.ok.length;c++)if(b==a.ok[c])return;a.no(b,"_")};
D.GU.prototype.no=function(a,b){if(a instanceof D.mh){var c=D.p,d=D.p;if("solid"==this.C(b,"bs")){var c=D.k,e=this.C(b,"bc");e==D.o&&(e="#000000");var f=this.C(b,"gc");f!=D.o&&"none"!=f&&(d=D.k)}var g=a.jia,h=a.r6;!c&&g!=D.o?(this.removeChild(g),a.jia=D.o,h!=D.o&&(this.removeChild(h),a.r6=D.o)):!d&&h!=D.o&&(this.removeChild(h),a.r6=D.o);var j=a.Xa();if(c){var c=(0,window.parseInt)(this.C(b,"bw"),10),l=(0,window.parseInt)(this.C(b,"bof"),10);g==D.o&&("circle"==j?(this.AH()&&(l=0),g=new D.mh(this.j(),
j,D.o,this.pa(a)-l,this.qa(a)-l,a.G().e+2*l,a.G().g+2*l,a.getId()+"_border",a.Ac(),a.Hc())):g=this.Tc()?new D.mh(this.j(),j,D.o,this.qa(a)-(c+1)/2,this.pa(a)-(c+1)/2,a.G().e+(c+1),a.G().g+(c+1),a.getId()+"_border",a.Ac(),a.Hc()):new D.mh(this.j(),j,D.o,this.pa(a)-l,this.qa(a)-l,a.G().e+2*l,a.G().g+2*l,a.getId()+"_border",a.Ac(),a.Hc()),this.Ua(g,this.Tf(a)),a.jia=g,g.P(this.gma));e=new D.J(e,this.C(b,"bo"),c);g.ba(e);(this.Tc()||"square"==j||"diamond"==j||"triangleUp"==j||"triangleDown"==j||"plus"==
j)&&"false"!=this.t5.hca&&(0,D.Ti)(g);d&&(h==D.o&&(h=l-c,"circle"==j?(this.AH()&&(h=0),h=new D.mh(this.j(),j,D.o,this.pa(a)-h,this.qa(a)-h,a.G().e+2*h,a.G().g+2*h,a.getId()+"_glow",a.Ac(),a.Hc())):h=this.Tc()?new D.mh(this.j(),j,D.o,this.qa(a),this.pa(a)-1,a.G().e+3,a.G().g+3,a.getId()+"_glow",a.Ac(),a.Hc()):new D.mh(this.j(),j,D.o,this.pa(a)-h,this.qa(a)-h,a.G().e+2*h,a.G().g+2*h,a.getId()+"_glow",a.Ac(),a.Hc()),this.Ua(h,this.Tf(g)),a.r6=h,h.P(this.gma)),f=new D.J(f,this.C(b,"go"),4),h.ba(f),(this.Tc()||
"square"==j||"diamond"==j||"triangleUp"==j||"triangleDown"==j||"plus"==j)&&"false"!=this.t5.hca&&(0,D.Ti)(h))}}else if((j=a.getId())&&"_drn_"==j.substring(0,5))j=this.C(b,"dbc"),j==D.o&&(j="#000000"),f=(0,window.parseInt)(this.C(b,"dbw"),10),a.ba(new D.J(j,1,f))};D.GU.prototype.dg=function(){this.Hga||(this.Hga=new D.kV(this));return this.Hga};D.GU.prototype.getAutomation=D.GU.prototype.dg;
D.dV=function(a){this.Init(a)};D.z.q(D.dV,D.z,"DvtTimelineOverviewParser");D.y=D.dV.prototype;D.y.Init=function(a){this.K=a;this.jv=new D.Ij};D.y.parse=function(a){var b=this.jv.parse(a);a=this.Cy(b);var b=b.Gc(),c;if(c=b[0]){var d={};d.width=c.B("width");d.height=c.B("height");d.bNa=c.Gc();c=d}else c=D.o;a.xta=c;a.NLa=this.A8(b[1],a.Ypa);2<b.length&&(a.yHa=!b[2]?D.o:b[2].Gc());return a};
D.y.Cy=function(a){var b={};b.start=(0,window.parseInt)(a.B("start"));b.end=(0,window.parseInt)(a.B("end"));b.width=(0,window.parseInt)(a.B("width"));b.yca=(0,window.parseInt)(a.B("renstart"));b.currentTime=(0,window.parseInt)(a.B("ocd"));b.orientation=a.B("orn");b.Tsa=a.B("ovp");b.TS=a.B("selmode");b.Eba=a.B("rtl");b.borderTopStyle=a.B("_bts");b.borderTopColor=a.B("_btc");b.CMa=a.B("sid");b.vpa=a.B("_aoc");var c={};c.shape=a.B("_ds");c.SH=a.B("_dsx");c.TH=a.B("_dsy");c.opacity=a.B("_do");c.color=
a.B("_fc");c.hca=a.B("_ph");b.Ypa=c;b.lba=a.B("_hfc");b.nba=a.B("_htc");b.Jra=a.B("_hbi");b.Vra=a.B("_hw");b.Sra=a.B("_hh");b.cda=a.B("_wbc");b.kda=a.B("_wbts");b.ida=a.B("_wbrs");b.eda=a.B("_wbbs");b.gda=a.B("_wbls");b.jda=a.B("_wbtc");b.hda=a.B("_wbrc");b.dda=a.B("_wbbc");b.fda=a.B("_wblc");b.cca=a.B("_obc");b.N$=a.B("_ctic");b.Wca=a.B("_tic");b.vta=a.B("_tabc");b.wta=a.B("_tabo");c={};c._bs=a.B("_bs");c._bc=a.B("_bc");c._bw=a.B("_bw");c._bof=a.B("_bof");c._bo=a.B("_bo");c._gc=a.B("_gc");c._go=
a.B("_go");c._dbs=a.B("_dbs");c._dbc=a.B("_dbc");c._dbw=a.B("_dbw");c._hbs=a.B("_hbs");c._hbc=a.B("_hbc");c._hbw=a.B("_hbw");c._hbof=a.B("_hbof");c._hbo=a.B("_hbo");c._hgc=a.B("_hgc");c._hgo=a.B("_hgo");c._hdbs=a.B("_hdbs");c._hdbc=a.B("_hdbc");c._hdbw=a.B("_hdbw");c._sbs=a.B("_sbs");c._sbc=a.B("_sbc");c._sbw=a.B("_sbw");c._sbof=a.B("_sbof");c._sbo=a.B("_sbo");c._sgc=a.B("_sgc");c._sgo=a.B("_sgo");c._sdbs=a.B("_sdbs");c._sdbc=a.B("_sdbc");c._sdbw=a.B("_sdbw");c._asbs=a.B("_asbs");c._asbc=a.B("_asbc");
c._asbw=a.B("_asbw");c._asbof=a.B("_asbof");c._asbo=a.B("_asbo");c._asgc=a.B("_asgc");c._asgo=a.B("_asgo");c._asdbs=a.B("_asdbs");c._asdbc=a.B("_asdbc");c._asdbw=a.B("_asdbw");b.pGa=c;return b};D.y.A8=function(a,b){if(!a)return D.o;for(var c=[],d=a.Gc(),e=0;e<d.length;e++){var f=this.z2(d[e],b),f=new D.lV(this.K,f);c.push(f)}return c};
D.y.z2=function(a,b){var c={},d="true"==a.B("_sd");c.id=a.B("tid");c.LM=a.B("rk");c.time=a.B("t");c.$G=a.B("et");c.shape=a.B("s");d&&c.shape==D.o&&(c.shape=b.shape);c.Q$=a.B("d");c.color=a.B("c");c.tZ=a.B("dfc");d&&c.color==D.o&&(c.color=b.color);c.SH=a.B("sx");d&&c.SH==D.o&&(c.SH=b.SH);c.TH=a.B("sy");d&&c.TH==D.o&&(c.TH=b.TH);c.cKa=a.B("g");c.opacity=a.B("o");d&&c.opacity==D.o&&(c.opacity=b.opacity);return c};
D.lV=function(a,b){this.Init(a,b)};D.z.q(D.lV,D.z,"DvtTimelineOverviewNode");D.y=D.lV.prototype;
D.y.Init=function(a,b){this.K=a;this.HQ=b.LM;this.ib=b.id;this.yFa=(0,window.parseInt)(b.time);this.Mk=b.$G==D.o?D.o:(0,window.parseInt)(b.$G);this.I="circle";"square"==b.shape?this.I="square":"plus"==b.shape?this.I="plus":"diamond"==b.shape?this.I="diamond":"triangleUp"==b.shape?this.I="triangleUp":"triangleDown"==b.shape&&(this.I="triangleDown");this.TO=b.Q$;this.fk=b.color;this.t6=b.cKa;b.opacity!=D.o&&(this.yDa=(0,window.parseFloat)(b.opacity));b.SH!=D.o&&(this.cFa=(0,window.parseFloat)(b.SH));
b.TH!=D.o&&(this.dFa=(0,window.parseFloat)(b.TH));b.tZ!=D.o&&(this.mz=b.tZ)};D.y.getId=(0,D.x)("ib");D.y.Raa=(0,D.x)("HQ");D.y.getTime=(0,D.x)("yFa");D.y.Ac=(0,D.x)("cFa");D.y.Hc=(0,D.x)("dFa");D.y.zb=(0,D.x)("fk");D.y.yb=(0,D.x)("I");D.y.Maa=(0,D.x)("yDa");D.y.xa=(0,D.x)("qh");D.y.Df=(0,D.v)("qh");D.y.pa=(0,D.x)("Eb");D.y.ha=(0,D.v)("Eb");D.y.qa=(0,D.x)("Yb");D.y.ya=(0,D.v)("Yb");
D.hV=function(a){this.Init("timeline");this.rm=a};D.z.q(D.hV,D.KP,"DvtTimelineOverviewEvent");D.hV.prototype.kH=function(){return this.$i("itemId")};
D.kV=function(a){this.gc(a)};D.z.q(D.kV,D.Wj,"DvtTimelineOverviewAutomation");D.kV.prototype.gc=(0,D.v)("rc");
D.kV.prototype.Xl=function(a){var b=a.getId();if(a instanceof D.mh){a=b.split(":");if(4!=a.length)return D.o;b=this.rc.sY==D.o?D.o:this.rc.sY.split(" ");if(b!=D.o&&(b=b.indexOf(a[1]),-1<b))return"marker["+b+"]["+a[2]+"]"}else{if("window"==b)return"range_window";if("lh"==b||"lhb"==b||"lbgrh"==b)return"range_start_handle";if("rh"==b||"rhb"==b||"rbgrh"==b)return"range_end_handle";if("grpy"==b)return a=a.getParent().BR(a),this.Xl(a)}return D.o};
D.kV.prototype.fg=function(a){for(var b=a.split("["),c=b.length,d=1;d<c;d++){var e=b[d],e=e.substr(0,e.length-1),f=(0,window.parseFloat)(e),e=(0,window.isNaN)(f)?e:f;b[d]=e}if(b&&3==b.length&&"marker"==b[0]){if(c=this.rc.sY==D.o?D.o:this.rc.sY.split(" "),c!=D.o&&(d=(0,window.parseInt)(b[1],10),-1<d&&d<c.length)){a:{a=this.rc.Ez;b="tl1:"+c[d]+":"+b[2]+":";for(c=0;c<a.length;c++)if(d=a[c],e=d.getId(),e!=D.o&&0==e.indexOf(b)){b=d;break a}b=D.o}return b?b.xa().Aa():D.o}}else{if("range_window"==a)return this.rc.la(1).Aa();
if("range_start_handle"==a)return this.rc.la(this.rc.Ka()-this.rc.rq).Aa();if("range_end_handle"==a)return(0,D.EP)(this.rc).Aa()}return D.o};(0,D.ca)("DvtTimelineOverviewAutomation.prototype.getDomElementForSubId",D.kV.prototype.fg);
  return D;
});